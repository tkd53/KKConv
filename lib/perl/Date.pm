#=====================================================================================
#                        Date.pm
#                             by Shinsuke MORI
#                             Last change : 14 March 2002
#=====================================================================================

#-------------------------------------------------------------------------------------
#                        movedate
#-------------------------------------------------------------------------------------

sub movedate{
    (@_ == 4) || die;
    my($n, @date) = @_;

    if ($n < 0){                                  # $n 日遡る
        while ($n++ < 0){                        
            @date = &prevdate(@date);
        }
        return(@date);
    }
    if ($n > 0){                                  # $n 日進む
        while ($n-- > 0){                        
            @date = &nextdate(@date);
        }
        return(@date);
    }
    return(@date);
}


#-------------------------------------------------------------------------------------
#                        nextdate
#-------------------------------------------------------------------------------------

sub nextdate{
    (@_ == 3) || die;
    my($Y, $M, $D) = @_;

    $D++;

    if ($M == 2){
        if ($Y%4 == 0){                           # 閏年の場合
            if ($D > 29){
                $D = 1;
                $M++;
            }
        }else{                                    # 閏年でない場合
            if ($D > 28){
                $D = 1;
                $M++;
            }
        }
    }elsif (($M == 4) || ($M == 6) || ($M == 9) || ($M == 11)){
        if ($D > 30){
            $D = 1;
            $M++;
        }
    }else{
        if ($D > 31){
            $D = 1;
            $M++;
        }
    }

    if ($M > 12){
        $M = 1;
        $Y = ($Y == 99) ? 0 : $Y+1;
    }

    return($Y, $M, $D);
}


#-------------------------------------------------------------------------------------
#                        prevdate
#-------------------------------------------------------------------------------------

sub prevdate{
    (@_ == 3) || die;
    my($Y, $M, $D) = @_;

    $D--;

    if ($D < 1){
        $M--;
        if ($M < 1){
            $M = 12;
            $Y = ($Y == 0) ? 99 : $Y-1;
        }
        if ($M == 2){
            if ($Y%4 == 0){                       # 閏年の場合
                $D = 29;
            }else{                                # 閏年でない場合
                $D = 28;
            }
        }elsif (($M == 4) || ($M == 6) || ($M == 9) || ($M == 11)){
            $D = 30;
        }else{
            $D = 31;
        }
    }

    return($Y, $M, $D);
}


#-------------------------------------------------------------------------------------
#                        datecmp
#-------------------------------------------------------------------------------------

# 機  能 : 日付の比較
#
# 使用法 : &datecmp(DATE, DATE)
#
# 実  例 : &datecmp("990112", "990112");
#
# 注意点 : 年の扱いは下位２桁のみ(2079年まで有効)

sub datecmp{
    (@_ == 2) || die;
    my($D0, $D1) = @_;

    $D0 = ((substr($D0, 0, 2)+0 < 80) ? "20" : "19") . $D0;
    $D1 = ((substr($D1, 0, 2)+0 < 80) ? "20" : "19") . $D1;

    return(($D0 cmp $D1));
}


#-------------------------------------------------------------------------------------
#                        return
#-------------------------------------------------------------------------------------

1;


#=====================================================================================
#                        END
#=====================================================================================
