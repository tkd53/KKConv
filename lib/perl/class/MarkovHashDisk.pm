#=====================================================================================
#                        MarkovHashDisk.pm
#                             by Shinsuke MORI
#                             Last change : 29 January 2003
#=====================================================================================

# 機  能 : 単純マルコフモデルをハッシュを用いて実装する。
#
# 注意点 : 状態列からハッシュキーへの関数は連接であり、これが単射となる必要がある。


#-------------------------------------------------------------------------------------
#                        declalations
#-------------------------------------------------------------------------------------

require "class/MarkovHash.pm";

package MarkovHashDisk;
@ISA = qw( MarkovHash );

use Carp;
use POSIX;


#-------------------------------------------------------------------------------------
#                        set variables
#-------------------------------------------------------------------------------------

$SUFFIX = ".db";                                # ファイル名の拡張子


#-------------------------------------------------------------------------------------
#                        new
#-------------------------------------------------------------------------------------

# new(IntStr, SIZE, FILE)
#
# 機  能 : マルコフモデルのためのハッシュを生成する。

sub new{
    (@_ == 3) || die;
    my($type, $size, $FILE) = @_;
#    printf(STDERR "%s::new(%d, %s)\n", $type, $size, $FILE);

    my(%hash);
    my($HASH) = $FILE . $SUFFIX;
    if (-e $HASH){
        tie(%hash, DB_File, $HASH, O_RDWR) || die "Can't open $HASH: $!\n";
#        tie(%hash, BerkeleyDB::Hash, -Filename => $HASH)
#            || die "Can't open $HASH: $!\n";
    }else{
        tie(%hash, DB_File, $HASH, O_CREAT|O_RDWR) || die "Can't open $HASH: $!\n";
        $hash{"_size_"} = $size;
    }

    return(bless(\%hash));
}


#-------------------------------------------------------------------------------------
#                        return
#-------------------------------------------------------------------------------------

1;


#=====================================================================================
#                        END
#=====================================================================================
