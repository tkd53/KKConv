#!/usr/bin/env perl
use bytes;
#=====================================================================================
#                       make-train.perl
#                             bShinsuke Mori
#                             Last change 12 July 2011
#=====================================================================================

# 機  能 : 学習コーパスの作成
#
# 使用法 : make-train.perl
#
# 実  例 : make-train.perl
#
# 注意点 : ログのあるディレクトリで実行


#-------------------------------------------------------------------------------------
#                        require
#-------------------------------------------------------------------------------------

use Env;
use POSIX;
use English;
use File::Basename;
unshift(@INC, dirname($0), "$HOME/usr/lib/perl", "$HOME/CrossEntropy/methods");

require "Help.pm";


#-------------------------------------------------------------------------------------
#                        check arguments
#-------------------------------------------------------------------------------------

((@ARGV == 0) && ($ARGV[0] ne "-help")) || &Help($0);
print STDERR join(" ", basename($0), @ARGV), "\n";


#-------------------------------------------------------------------------------------
#                        set variables
#-------------------------------------------------------------------------------------

$HD = 100;                                        # 半減する日数

$DIRE = ".";
opendir(DIRE, $DIRE) || die "Can't open directory $DIRE\n";
@FILE = grep(m/(\d\d\d\d-\d\d-\d\d|test)\.wordkkci$/, readdir(DIRE));
closedir(DIRE);


#-------------------------------------------------------------------------------------
#                       main
#-------------------------------------------------------------------------------------

srand;
$nday = 0;                                        # 日数
foreach $FILE (reverse(sort(@FILE))){
    $r = exp(log(0.5)*($nday/$HD));
    open(FILE) || die "Can't open $FILE: $!\n";
    $l = 0;
    while (<FILE>){
        (rand() < $r) || next;
        print;
        $l++;
    }
    close(FILE);
    printf(STDERR "%s %5.3f, %d\n", $FILE, $r, $l);
    $nday++;
}


#-------------------------------------------------------------------------------------
#                        close
#-------------------------------------------------------------------------------------

exit(0);


#=====================================================================================
#                        END
#=====================================================================================
